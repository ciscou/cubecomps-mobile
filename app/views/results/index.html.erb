<% content_for(:back_button) do %>
 <%= link_to "Back", competition_categories_path(@round.competition_id), data: { icon: "back" } %>
<% end %>
<% content_for(:title) do %>
  <% cache [@round, "competition_name"] do %>
    <%= @round.competition_name %>
  <% end %>
<% end %>

<% cache [@round, "category_and_round"] do %>
  <h2><%= @round.category_name %> - <%= @round.name %></h2>
<% end %>

<% cache [@round, "results"], expires_in: 5.minutes, race_condition_ttl: 10 do %>
  <%= content_tag :table, id: "results", class: "table-stripe", data: { role: "table", mode: "columntoggle", generated_at: Time.now.to_s(:db) } do %>
    <thead>
      <tr>
        <th class="number">#</th>
        <th>Name</th>
        <th data-priority="3">Country</th>
        <% (1..5).each do |i| %>
          <% if @round.send("t#{i}?") %>
            <th class="number" data-priority="2">T<%= i %></th>
          <% end %>
        <% end %>
        <% if @round.average? %>
          <th class="number" data-priority="1">Average</th>
        <% end %>
        <% if @round.mean? %>
          <th class="number" data-priority="1">Mean</th>
        <% end %>
        <% if @round.best? %>
          <th class="number" data-priority="1">Best</th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <%= render partial: "row", collection: @round.results, as: :result, locals: { round: @round } %>
    </tbody>
  <% end %>
<% end %>

<% cache [@round, "results", "more_info"], expires_in: 5.minutes, race_condition_ttl: 10 do %>
  <%= render partial: "more_info", collection: @round.results, as: :result, locals: { round: @round } %>
<% end %>
